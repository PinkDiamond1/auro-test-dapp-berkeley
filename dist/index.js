import{getZkbody}from"./zk/zkApp";let account;const initializeMina=async()=>{const e=document.getElementById("connectButton"),n=document.getElementById("getAccounts"),t=document.getElementById("getAccountsResult");e.onclick=async()=>{if(window.mina){e.innerText="Onboarding in progress";let n=await window.mina.requestAccounts().catch((e=>e));if(n.message)e.innerText=n.message;else{let t=n;account=t,document.getElementById("accounts").innerHTML=t,e.innerText="Connected",e.disabled=!0}}else alert("No provider was found 请先安装 Auro Wallet")},(async()=>{if(window.mina){let n=await window.mina.requestAccounts().catch((e=>e)),a=n;n.message?t.innerHTML=n.message:(account=a,document.getElementById("accounts").innerHTML=a,e.innerText="Connected",e.disabled=!0,t.innerHTML=a)}})(),n.onclick=async()=>{if(window.mina){let e=await window.mina.requestAccounts().catch((e=>e)),n=e;e.message?t.innerHTML=e.message:t.innerHTML=n}};const a=document.getElementById("sendButton"),o=document.getElementById("sendAmountInput"),i=document.getElementById("receiveAddressInput"),s=document.getElementById("sendFee"),c=document.getElementById("sendMemo"),d=document.getElementById("sendResultDisplay");a.onclick=async()=>{let e=await window.mina.sendLegacyPayment({amount:o.value,to:i.value,fee:s.value,memo:c.value}).catch((e=>e));e.hash?d.innerHTML=e.hash:d.innerHTML=e.message};const m=document.getElementById("stakingButton"),l=document.getElementById("vaildatorAddressInput"),u=document.getElementById("stakeFee"),g=document.getElementById("stakeMemo"),r=document.getElementById("stakingResultDisplay");m.onclick=async()=>{let e=await window.mina.sendLegacyStakeDelegation({to:l.value,fee:u.value,memo:g.value}).catch((e=>e));e.hash?r.innerHTML=e.hash:r.innerHTML=e.message};const y=document.getElementById("signPartyButton"),w=document.getElementById("partyResultDisplay"),B=document.getElementById("buildTip"),I=(document.getElementById("gqlContent"),document.getElementById("zkAppAddress"),document.getElementById("signPartyFee")),E=document.getElementById("signPartyMemo");y.onclick=async()=>{B.hidden=!1;let e=await getZkbody("https://proxy.berkeley.minaexplorer.com/graphql","B62qoUNgXPX9GUS7XdLTHQNZc2vYbm6BaGpEXYgha138wnAGtZd8R3T");console.log("getZkbody==0",JSON.stringify(e)),B.hidden=!0;let n=await window.mina.sendTransaction({transaction:e,feePayer:{memo:E.value||"",fee:I.value||""}}).catch((e=>e));console.log("signPartyButton==1",n),n.hash?w.innerHTML=n.hash:w.innerHTML=n.message};const h=document.getElementById("signMessageButton"),M=document.getElementById("signMessageContent"),T=document.getElementById("signMessageResult");let p;h.onclick=async()=>{p=await window.mina.signMessage({message:M.value}).catch((e=>e)),p.signature?T.innerHTML=JSON.stringify(p.signature):T.innerHTML=p.message};const v=document.getElementById("signVerifyButton"),f=document.getElementById("verifyResult"),L=document.getElementById("verifySignature"),k=document.getElementById("verifyMessage");v.onclick=async()=>{let e,n=account&&account.length>0?account[0]:"",t=L.value;try{e=JSON.parse(t)}catch(e){}if(!e)return void console.log("please input value json");let a={publicKey:n,signature:{field:e?.field,scalar:e?.scalar},payload:k.value},o=await window.mina.verifyMessage(a).catch((e=>e));f.innerHTML=o.error?.message||o},setTimeout((async()=>{window.mina&&(window.mina.on("accountsChanged",b),window.mina.on("chainChanged",A),A(await window.mina.requestNetwork().catch((e=>e))))}),200);const H=document.getElementById("network");function A(e){H.innerHTML=e}function b(n){Array.isArray(n)&&(document.getElementById("accounts").innerHTML=n,0===n.length&&(e.innerText="Connect",e.disabled=!1))}};window.addEventListener("DOMContentLoaded",initializeMina);